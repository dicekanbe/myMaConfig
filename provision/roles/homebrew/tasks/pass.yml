---
- name: Install brew packages
  homebrew:
    name: "{{ item.name }}"
  with_items:
    - { name: pass }
    - { name: pass-otp }
    - { name: pinentry-mac }

- name: Install safari extension
  homebrew_cask:
    name: adur1990/tap/passformacos

- name: Change permission
  shell: chmod 700 $HOME/.gnupg

- name: Create conf
  copy:
    content: ''
    dest: $HOME/.gnupg/gpg-agent.conf
    force: no

- name: Get path of pinentry-mac
  shell: which pinentry-mac
  register: pinentry_mac_path

- name: Change config
  lineinfile:
    path:  $HOME/.gnupg/gpg-agent.conf
    line: 'pinentry-program {{ pinentry_mac_path }}'
